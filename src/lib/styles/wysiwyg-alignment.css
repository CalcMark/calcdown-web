/**
 * WYSIWYG Editor Alignment CSS
 *
 * CRITICAL: These rules ensure pixel-perfect alignment between:
 * - Textarea (invisible, editable)
 * - Overlay (visible, syntax-highlighted)
 * - Gutter (calculation results)
 *
 * ANY change to padding, margin, line-height, or font properties
 * will break cursor positioning.
 *
 * Tests: e2e/wysiwyg-precise-alignment.spec.ts
 */

/* ============================================================================
   BASE FONT & SPACING CONSTANTS
   ============================================================================ */

:root {
	--wysiwyg-font-size: 1rem; /* 16px default */
	--wysiwyg-line-height: 1.75; /* Unitless ratio */
	--wysiwyg-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
	--wysiwyg-padding: 2.5rem;
}

/* ============================================================================
   TEXTAREA (Source of Truth)
   ============================================================================ */

.raw-textarea {
	font-family: var(--wysiwyg-font-family);
	font-size: var(--wysiwyg-font-size);
	line-height: var(--wysiwyg-line-height);
	padding: var(--wysiwyg-padding);

	/* Reset all spacing that could affect alignment */
	margin: 0;
	border: 0;
	outline: 0;

	/* Text rendering must match overlay */
	white-space: pre-wrap;
	word-wrap: break-word;
	word-break: break-word;
	overflow-wrap: anywhere;

	/* No text transforms */
	text-transform: none;
	letter-spacing: normal;
	word-spacing: normal;
}

/* ============================================================================
   OVERLAY (Visual Representation)
   ============================================================================ */

.rendered-overlay {
	/* MUST match textarea exactly */
	font-family: var(--wysiwyg-font-family);
	font-size: var(--wysiwyg-font-size);
	line-height: var(--wysiwyg-line-height);
	padding: var(--wysiwyg-padding);

	/* Reset all spacing */
	margin: 0;
	border: 0;

	/* Text rendering MUST match textarea */
	white-space: pre-wrap;
	word-wrap: break-word;
	word-break: break-word;
	overflow-wrap: anywhere;

	/* No text transforms */
	text-transform: none;
	letter-spacing: normal;
	word-spacing: normal;
}

/* ============================================================================
   LINES (Individual Text Lines)
   ============================================================================ */

.rendered-overlay .line {
	/* CRITICAL: Prevent empty lines from collapsing */
	min-height: calc(var(--wysiwyg-font-size) * var(--wysiwyg-line-height));

	/* Reset all spacing */
	margin: 0;
	padding: 0;
	border: 0;

	/* Text wrapping must match textarea */
	overflow-wrap: anywhere;
	word-break: break-word;
	hyphens: none;
}

/* Ensure nested elements don't add spacing */
.rendered-overlay .line * {
	overflow-wrap: anywhere;
	word-break: break-word;
}

/* ============================================================================
   MARKDOWN ELEMENTS (Must Not Add Spacing)
   ============================================================================ */

/* Reset ALL default browser spacing for markdown elements */
.rendered-overlay :is(h1, h2, h3, h4, h5, h6, p, blockquote, ul, ol, li, strong, em, code) {
	margin: 0;
	padding: 0;
	border: 0;
	/* Inherit line-height from parent */
	line-height: inherit;
}

/* ============================================================================
   CALCULATION SPANS (Syntax Highlighting)
   ============================================================================ */

.rendered-overlay .calculation {
	/* Visual styling only - NO spacing that affects layout */
	/* background removed for cleaner appearance */
	background: transparent;
	border-radius: 0.25rem;

	/* CRITICAL: Zero spacing */
	margin: 0;
	padding: 0;
	border: 0;

	/* Must be inline to not affect line height */
	display: inline;

	/* Inherit typography */
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
	letter-spacing: inherit;
	word-spacing: inherit;
}

/* ============================================================================
   TOKEN SPANS (Individual Syntax Elements)
   ============================================================================ */

.rendered-overlay .calculation span,
.rendered-overlay [class^='cm-'],
.rendered-overlay [class*=' cm-'] {
	/* CRITICAL: Absolutely zero spacing */
	margin: 0;
	padding: 0;
	border: 0;

	/* Must be inline */
	display: inline;

	/* Inherit ALL typography */
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
	letter-spacing: inherit;
	word-spacing: inherit;

	/* Only color and font-weight allowed for syntax highlighting */
	/* Any other property will break alignment */
}

/* ============================================================================
   GUTTER (Calculation Results)
   ============================================================================ */

.gutter {
	font-family: var(--wysiwyg-font-family);
	font-size: var(--wysiwyg-font-size);
	line-height: var(--wysiwyg-line-height);
	padding-block: var(--wysiwyg-padding);
}

.gutter-line {
	/* Match line height exactly */
	line-height: var(--wysiwyg-line-height);
	font-size: var(--wysiwyg-font-size);

	/* CRITICAL: Zero vertical spacing */
	margin: 0;
	padding: 0;
	border: 0;
}

.gutter-result {
	/* Visual only - no spacing that changes line height */
	display: inline-block;
	vertical-align: baseline;

	/* Match parent line-height */
	line-height: var(--wysiwyg-line-height);

	/* CRITICAL: Zero vertical padding */
	padding-block: 0;

	/* Horizontal padding OK */
	padding-inline: 0.5rem;
}

/* ============================================================================
   TESTING UTILITIES
   ============================================================================ */

/* When testing alignment, uncomment to visualize:

.raw-textarea {
	outline: 2px solid red !important;
}

.rendered-overlay {
	outline: 2px solid blue !important;
}

.rendered-overlay .line {
	outline: 1px dotted green !important;
}
*/
